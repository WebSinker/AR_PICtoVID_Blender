<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR Video Maker - Create Your AR Experience</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .header p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .step-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .step-card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      transition: transform 0.3s ease;
    }

    .step-card:hover {
      transform: translateY(-5px);
    }

    .step-number {
      display: inline-block;
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 40px;
      font-weight: bold;
      font-size: 1.2em;
      margin-bottom: 15px;
    }

    .step-card h3 {
      color: #333;
      margin-bottom: 15px;
      font-size: 1.3em;
    }

    .upload-zone {
      border: 3px dashed #ccc;
      border-radius: 15px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #f9f9f9;
      margin-bottom: 15px;
    }

    .upload-zone:hover {
      border-color: #667eea;
      background: #f0f0ff;
    }

    .upload-zone.active {
      border-color: #4caf50;
      background: #f0fff0;
    }

    .upload-zone img, .upload-zone video {
      max-width: 100%;
      max-height: 200px;
      margin-top: 15px;
      border-radius: 10px;
    }

    .file-input {
      display: none;
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 25px;
      font-size: 1.1em;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      display: inline-block;
      margin: 10px 5px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-success {
      background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
    }

    .btn-warning {
      background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
    }

    .result-section {
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      display: none;
      text-align: center;
    }

    .result-section.show {
      display: block;
      animation: slideIn 0.5s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .qr-container {
      margin: 30px 0;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 15px;
      display: inline-block;
    }

    #qrcode canvas, #qrcode img {
      margin: 0 auto;
      display: block;
    }

    .ar-link {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
      word-break: break-all;
      font-family: 'Courier New', monospace;
      border-left: 4px solid #2196f3;
    }

    .instructions {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      text-align: left;
    }

    .instructions h4 {
      color: #856404;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .instructions ol {
      margin-left: 20px;
      line-height: 2;
    }

    .instructions li {
      margin-bottom: 10px;
    }

    .preview-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }

    .preview-item {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 10px;
    }

    .preview-item h4 {
      margin-bottom: 10px;
      color: #667eea;
    }

    .icon {
      font-size: 2em;
      margin-bottom: 10px;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }

    .loading.show {
      display: block;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .alert {
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
      font-weight: 500;
    }

    .alert-info {
      background: #d1ecf1;
      color: #0c5460;
      border-left: 4px solid #17a2b8;
    }

    @media (max-width: 768px) {
      .preview-grid {
        grid-template-columns: 1fr;
      }
      
      .header h1 {
        font-size: 1.8em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üé¨ AR Video Maker</h1>
      <p>Transform any photo into an interactive AR experience!</p>
    </div>

    <!-- Step Cards -->
    <div class="step-cards">
      <!-- Step 1: Upload Image -->
      <div class="step-card">
        <div class="step-number">1</div>
        <h3>üì∏ Upload Target Image</h3>
        <p style="color: #666; margin-bottom: 15px;">Choose the photo that will trigger your AR video (e.g., student drawing, poster, book cover)</p>
        <div class="upload-zone" id="imageZone" onclick="document.getElementById('imageInput').click()">
          <div class="icon">üñºÔ∏è</div>
          <p><strong>Click to upload image</strong></p>
          <p style="font-size: 0.9em; color: #999;">JPG or PNG ‚Ä¢ Best: High contrast images</p>
          <img id="imagePreview" style="display: none;">
        </div>
        <input type="file" id="imageInput" class="file-input" accept="image/*">
      </div>

      <!-- Step 2: Upload Video -->
      <div class="step-card">
        <div class="step-number">2</div>
        <h3>üé• Upload AR Video</h3>
        <p style="color: #666; margin-bottom: 15px;">Upload the video that will play when the image is detected</p>
        <div class="upload-zone" id="videoZone" onclick="document.getElementById('videoInput').click()">
          <div class="icon">üìπ</div>
          <p><strong>Click to upload video</strong></p>
          <p style="font-size: 0.9em; color: #999;">MP4 or WebM ‚Ä¢ Max 50MB recommended</p>
          <video id="videoPreview" style="display: none;" controls></video>
        </div>
        <input type="file" id="videoInput" class="file-input" accept="video/*">
      </div>

      <!-- Step 3: Generate -->
      <div class="step-card">
        <div class="step-number">3</div>
        <h3>‚ú® Generate AR Experience</h3>
        <p style="color: #666; margin-bottom: 15px;">Create your QR code and AR link</p>
        <div style="text-align: center; padding: 20px;">
          <div class="icon">üéØ</div>
          <button class="btn btn-success" id="generateBtn" disabled onclick="generateAR()">
            üöÄ Generate AR Experience
          </button>
        </div>
        <div class="alert alert-info" style="font-size: 0.9em;">
          üí° <strong>Tip:</strong> Use images with good detail and contrast for best tracking results!
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Generating your AR experience...</p>
    </div>

    <!-- Result Section -->
    <div class="result-section" id="resultSection">
      <h2 style="color: #667eea; margin-bottom: 30px;">üéâ Your AR Experience is Ready!</h2>
      
      <div class="preview-grid">
        <div class="preview-item">
          <h4>üì∏ Target Image</h4>
          <img id="finalImagePreview" style="max-width: 100%; border-radius: 10px;">
        </div>
        <div class="preview-item">
          <h4>üé• AR Video</h4>
          <video id="finalVideoPreview" style="max-width: 100%; border-radius: 10px;" controls></video>
        </div>
      </div>

      <h3 style="margin: 30px 0 20px 0;">üì± Scan this QR Code to Experience AR</h3>
      <div class="qr-container">
        <div id="qrcode"></div>
      </div>

      <div class="ar-link">
        <strong>üîó Or use this link:</strong><br>
        <a id="arLink" href="#" target="_blank" style="color: #2196f3; text-decoration: none;"></a>
      </div>

      <div class="instructions">
        <h4>üìã How to Use Your AR Experience:</h4>
        <ol>
          <li><strong>Print the target image</strong> (the photo you uploaded in Step 1)</li>
          <li><strong>Scan the QR code</strong> above with a smartphone or tablet</li>
          <li><strong>Allow camera access</strong> when prompted</li>
          <li><strong>Point your camera at the printed image</strong></li>
          <li><strong>Watch the magic!</strong> Your video will appear and play on the image! üé¨‚ú®</li>
        </ol>
      </div>

      <div style="margin-top: 30px;">
        <button class="btn btn-success" onclick="downloadQR()">üì• Download QR Code</button>
        <button class="btn btn-warning" onclick="resetApp()">üîÑ Create Another</button>
      </div>

      <div class="alert alert-info" style="margin-top: 30px;">
        <strong>‚ö†Ô∏è Important Notes:</strong><br>
        ‚Ä¢ This is a demo interface. In production, you'd need:<br>
        &nbsp;&nbsp;&nbsp;- A server to host image descriptors (NFT markers)<br>
        &nbsp;&nbsp;&nbsp;- NFT Marker Creator to process the image<br>
        &nbsp;&nbsp;&nbsp;- AR.js viewer page to display the experience<br>
        ‚Ä¢ For schools: Host on your own server or use free hosting like GitHub Pages<br>
        ‚Ä¢ No subscription needed - works forever once set up!
      </div>
    </div>
  </div>

  <script>
    let uploadedImage = null;
    let uploadedVideo = null;
    let qrcodeInstance = null;

    // Image Upload Handler
    document.getElementById('imageInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          uploadedImage = event.target.result;
          const preview = document.getElementById('imagePreview');
          preview.src = uploadedImage;
          preview.style.display = 'block';
          document.getElementById('imageZone').classList.add('active');
          checkReadyToGenerate();
        };
        reader.readAsDataURL(file);
      }
    });

    // Video Upload Handler
    document.getElementById('videoInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          uploadedVideo = event.target.result;
          const preview = document.getElementById('videoPreview');
          preview.src = uploadedVideo;
          preview.style.display = 'block';
          document.getElementById('videoZone').classList.add('active');
          checkReadyToGenerate();
        };
        reader.readAsDataURL(file);
      }
    });

    // Check if ready to generate
    function checkReadyToGenerate() {
      if (uploadedImage && uploadedVideo) {
        document.getElementById('generateBtn').disabled = false;
      }
    }

    // Generate AR Experience
    function generateAR() {
      // Show loading
      document.getElementById('loading').classList.add('show');
      
      // Simulate processing time
      setTimeout(() => {
        document.getElementById('loading').classList.remove('show');
        
        // Show result section
        document.getElementById('resultSection').classList.add('show');
        
        // Update previews
        document.getElementById('finalImagePreview').src = uploadedImage;
        document.getElementById('finalVideoPreview').src = uploadedVideo;
        
        // Generate unique ID for this AR experience
        const experienceId = 'ar_' + Date.now();
        
        // Get the correct base URL including the repository path
        const currentPath = window.location.pathname;
        const basePath = currentPath.substring(0, currentPath.lastIndexOf('/') + 1);
        const baseURL = window.location.origin + basePath;
        const arURL = `${baseURL}ar-viewer.html?id=${experienceId}`;
        
        console.log('Generated AR URL:', arURL); // Debug log
        
        // Generate QR Code
        document.getElementById('qrcode').innerHTML = '';
        qrcodeInstance = new QRCode(document.getElementById('qrcode'), {
          text: arURL,
          width: 256,
          height: 256,
          colorDark: '#000000',
          colorLight: '#ffffff',
          correctLevel: QRCode.CorrectLevel.H
        });
        
        // Update link
        const linkElement = document.getElementById('arLink');
        linkElement.href = arURL;
        linkElement.textContent = arURL;
        
        // Scroll to result
        document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 2000);
    }

    // Download QR Code
    function downloadQR() {
      const canvas = document.querySelector('#qrcode canvas');
      if (canvas) {
        const link = document.createElement('a');
        link.download = 'ar-experience-qr.png';
        link.href = canvas.toDataURL();
        link.click();
      }
    }

    // Reset App
    function resetApp() {
      uploadedImage = null;
      uploadedVideo = null;
      document.getElementById('imagePreview').style.display = 'none';
      document.getElementById('videoPreview').style.display = 'none';
      document.getElementById('imageZone').classList.remove('active');
      document.getElementById('videoZone').classList.remove('active');
      document.getElementById('generateBtn').disabled = true;
      document.getElementById('resultSection').classList.remove('show');
      document.getElementById('imageInput').value = '';
      document.getElementById('videoInput').value = '';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  </script>
</body>
</html>