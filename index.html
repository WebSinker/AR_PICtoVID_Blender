<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stories AR Style - Custom Image AR Creator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .header p {
      font-size: 1.2em;
      opacity: 0.95;
    }

    .card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .step-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .step-number {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.5em;
      flex-shrink: 0;
    }

    .step-title {
      font-size: 1.5em;
      color: #333;
      font-weight: bold;
    }

    .upload-area {
      border: 3px dashed #ccc;
      border-radius: 15px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #f9f9f9;
      margin-bottom: 20px;
    }

    .upload-area:hover {
      border-color: #667eea;
      background: #f0f0ff;
    }

    .upload-area.active {
      border-color: #4caf50;
      background: #f0fff0;
    }

    .upload-area img,
    .upload-area video {
      max-width: 100%;
      max-height: 300px;
      margin-top: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 35px;
      border-radius: 25px;
      font-size: 1.1em;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
      margin: 10px 5px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-success {
      background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
    }

    .alert {
      padding: 20px;
      border-radius: 15px;
      margin: 20px 0;
      border-left: 5px solid;
    }

    .alert-info {
      background: #e3f2fd;
      border-color: #2196f3;
      color: #1976d2;
    }

    .alert-warning {
      background: #fff3cd;
      border-color: #ffc107;
      color: #856404;
    }

    .alert-success {
      background: #d4edda;
      border-color: #28a745;
      color: #155724;
    }

    .result-section {
      display: none;
      animation: slideIn 0.5s ease;
    }

    .result-section.show {
      display: block;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .qr-container {
      text-align: center;
      padding: 30px;
      background: #f9f9f9;
      border-radius: 15px;
      margin: 20px 0;
    }

    #qrcode {
      display: inline-block;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .preview-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }

    .preview-item {
      background: #f9f9f9;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
    }

    .preview-item h3 {
      color: #667eea;
      margin-bottom: 15px;
    }

    .preview-item img,
    .preview-item video {
      max-width: 100%;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .instructions-list {
      background: #f8f9fa;
      padding: 25px;
      border-radius: 15px;
      margin: 20px 0;
    }

    .instructions-list h3 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1.3em;
    }

    .instructions-list ol {
      margin-left: 25px;
      line-height: 2;
    }

    .instructions-list li {
      margin-bottom: 10px;
      color: #333;
    }

    .instructions-list strong {
      color: #667eea;
    }

    code {
      background: #f4f4f4;
      padding: 2px 8px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      color: #d63384;
    }

    .hidden {
      display: none;
    }

    @media (max-width: 768px) {
      .preview-grid {
        grid-template-columns: 1fr;
      }
      
      .header h1 {
        font-size: 1.8em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üé¨ Stories AR Style Creator</h1>
      <p>Turn any image into an AR experience - video plays directly on YOUR image!</p>
    </div>

    <!-- Step 1: Upload Target Image -->
    <div class="card">
      <div class="step-header">
        <div class="step-number">1</div>
        <div class="step-title">Upload Your Target Image</div>
      </div>
      
      <div class="alert alert-info">
        <strong>üí° This is the image that users will point their camera at!</strong><br>
        Examples: Student artwork, product photo, poster, book cover, etc.<br>
        <strong>Best results:</strong> Images with clear details, good contrast, not too much text.
      </div>
      
      <div class="upload-area" id="imageArea" onclick="document.getElementById('imageInput').click()">
        <div style="font-size: 3em;">üì∏</div>
        <h3>Click to Upload Target Image</h3>
        <p style="color: #666; margin-top: 10px;">The image your video will play on</p>
        <p style="color: #999; font-size: 0.9em;">JPG, PNG ‚Ä¢ High contrast images work best</p>
        <img id="imagePreview" style="display: none;">
      </div>
      <input type="file" id="imageInput" accept="image/*" style="display: none;">
    </div>

    <!-- Step 2: Upload Video -->
    <div class="card">
      <div class="step-header">
        <div class="step-number">2</div>
        <div class="step-title">Upload Your AR Video</div>
      </div>
      
      <div class="alert alert-info">
        <strong>üé• This video will play when camera sees your image!</strong><br>
        The video will appear overlaid on your image and auto-adjust to its size.
      </div>
      
      <div class="upload-area" id="videoArea" onclick="document.getElementById('videoInput').click()">
        <div style="font-size: 3em;">üé¨</div>
        <h3>Click to Upload Video</h3>
        <p style="color: #666; margin-top: 10px;">The video that plays on your image</p>
        <p style="color: #999; font-size: 0.9em;">MP4, WebM ‚Ä¢ Under 50MB recommended</p>
        <video id="videoPreview" controls style="display: none;"></video>
      </div>
      <input type="file" id="videoInput" accept="video/*" style="display: none;">
    </div>

    <!-- Step 3: Create NFT Markers -->
    <div class="card">
      <div class="step-header">
        <div class="step-number">3</div>
        <div class="step-title">Create AR Tracking Data (NFT Markers)</div>
      </div>
      
      <div class="alert alert-warning">
        <strong>‚ö†Ô∏è IMPORTANT: This step is REQUIRED for custom images!</strong><br>
        Unlike HIRO marker, custom images need special processing to be trackable.
      </div>

      <div class="instructions-list">
        <h3>üìã How to Create NFT Markers:</h3>
        <ol>
          <li><strong>Go to NFT Marker Creator:</strong> <a href="https://carnaux.github.io/NFT-Marker-Creator/" target="_blank" style="color: #667eea;">carnaux.github.io/NFT-Marker-Creator</a></li>
          <li><strong>Upload your image</strong> (the same one you uploaded above)</li>
          <li><strong>Wait for processing</strong> (takes 10-30 seconds)</li>
          <li><strong>Download the ZIP file</strong> containing 3 files:
            <ul style="margin-top: 10px;">
              <li><code>yourimage.fset</code></li>
              <li><code>yourimage.iset</code></li>
              <li><code>yourimage.fset3</code></li>
            </ul>
          </li>
          <li><strong>Upload these 3 files</strong> to your web server (same folder)</li>
          <li><strong>Note the URL path</strong> (without file extension)<br>
            Example: If files are at <code>https://mysite.com/markers/myimage.fset</code><br>
            Your marker URL is: <code>https://mysite.com/markers/myimage</code>
          </li>
        </ol>
      </div>

      <div style="margin-top: 20px;">
        <label style="display: block; margin-bottom: 10px; font-weight: bold; color: #333;">
          Enter your NFT Marker URL (without extension):
        </label>
        <input 
          type="text" 
          id="markerURL" 
          placeholder="https://yoursite.com/path-to-markers/yourimage"
          style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 1em;"
        >
        <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
          ‚ÑπÔ∏è Don't include .fset, .iset, or .fset3 - just the base path
        </p>
      </div>
    </div>

    <!-- Step 4: Generate -->
    <div class="card">
      <div class="step-header">
        <div class="step-number">4</div>
        <div class="step-title">Generate Your AR Experience</div>
      </div>
      
      <div style="text-align: center; padding: 20px;">
        <button class="btn btn-success" id="generateBtn" onclick="generateAR()" disabled>
          üöÄ Generate AR Experience
        </button>
      </div>
      
      <div class="alert alert-info">
        <strong>üì± What happens next:</strong><br>
        ‚Ä¢ System generates QR code<br>
        ‚Ä¢ QR code links to AR viewer<br>
        ‚Ä¢ Users scan QR ‚Üí Camera opens ‚Üí Point at YOUR image ‚Üí Video plays!
      </div>
    </div>

    <!-- Result Section -->
    <div id="resultSection" class="result-section">
      <div class="card">
        <h2 style="color: #667eea; text-align: center; margin-bottom: 30px;">
          üéâ Your Stories AR Experience is Ready!
        </h2>

        <div class="preview-grid">
          <div class="preview-item">
            <h3>üì∏ Target Image</h3>
            <p style="color: #666; margin-bottom: 15px;">Users point camera at this</p>
            <img id="finalImage" style="max-height: 250px;">
          </div>
          <div class="preview-item">
            <h3>üé• AR Video</h3>
            <p style="color: #666; margin-bottom: 15px;">Plays on the image</p>
            <video id="finalVideo" controls style="max-height: 250px;"></video>
          </div>
        </div>

        <div class="qr-container">
          <h3 style="margin-bottom: 20px; color: #667eea;">üì± Scan This QR Code</h3>
          <div id="qrcode"></div>
          <p style="margin-top: 20px; color: #666; font-size: 0.9em;">
            Scan with smartphone camera to launch AR experience
          </p>
        </div>

        <div style="background: #e3f2fd; padding: 20px; border-radius: 15px; margin: 20px 0;">
          <strong style="color: #667eea; font-size: 1.2em;">üîó AR Experience URL:</strong><br>
          <a id="arLink" href="#" target="_blank" style="color: #2196f3; word-break: break-all; font-family: 'Courier New', monospace;">
          </a>
        </div>

        <div class="instructions-list">
          <h3>üìã How to Use Your Stories AR Experience:</h3>
          <ol>
            <li><strong>Print the target image</strong> (your uploaded image from Step 1)</li>
            <li><strong>Share the QR code</strong> with your users</li>
            <li><strong>Users scan QR code</strong> with their smartphone</li>
            <li><strong>Camera opens automatically</strong></li>
            <li><strong>Point camera at printed image</strong></li>
            <li><strong>Video appears and plays</strong> directly on your image! üé¨‚ú®</li>
          </ol>
        </div>

        <div class="alert alert-success">
          <strong>‚úÖ Success Tips:</strong><br>
          ‚Ä¢ Print image on white paper, good quality<br>
          ‚Ä¢ Use in well-lit environment<br>
          ‚Ä¢ Hold phone 30-50cm from image<br>
          ‚Ä¢ Keep entire image visible to camera<br>
          ‚Ä¢ Image should be flat (not curved or folded)
        </div>

        <div style="text-align: center; margin-top: 30px;">
          <button class="btn btn-success" onclick="downloadQR()">üì• Download QR Code</button>
          <button class="btn" onclick="copyLink()">üìã Copy Link</button>
          <button class="btn" onclick="resetForm()">üîÑ Create Another</button>
        </div>
      </div>
    </div>

    <!-- Important Technical Note -->
    <div class="card">
      <h3 style="color: #667eea; margin-bottom: 15px;">‚öôÔ∏è Technical Requirements</h3>
      <div class="alert alert-warning">
        <strong>üö® CRITICAL: Server Setup Required</strong><br><br>
        
        For this to work, you need to host:<br><br>
        
        <strong>1. NFT Marker Files (.fset, .iset, .fset3)</strong><br>
        &nbsp;&nbsp;&nbsp;‚Üí Upload to your web server<br>
        &nbsp;&nbsp;&nbsp;‚Üí Note the URL path<br><br>
        
        <strong>2. Video File (.mp4)</strong><br>
        &nbsp;&nbsp;&nbsp;‚Üí Upload to your server or use video hosting<br>
        &nbsp;&nbsp;&nbsp;‚Üí Needs to be publicly accessible<br><br>
        
        <strong>3. AR Viewer Page (HTML)</strong><br>
        &nbsp;&nbsp;&nbsp;‚Üí Use <code>ar-viewer-custom-image.html</code> (see below)<br>
        &nbsp;&nbsp;&nbsp;‚Üí Upload to your web server<br><br>
        
        <strong>Free Hosting Options:</strong><br>
        ‚Ä¢ GitHub Pages (recommended for beginners)<br>
        ‚Ä¢ Netlify<br>
        ‚Ä¢ Vercel<br>
        ‚Ä¢ Firebase Hosting
      </div>
    </div>
  </div>

  <script>
    let uploadedImage = null;
    let uploadedVideo = null;
    let markerURL = '';

    // Image upload
    document.getElementById('imageInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          uploadedImage = event.target.result;
          document.getElementById('imagePreview').src = uploadedImage;
          document.getElementById('imagePreview').style.display = 'block';
          document.getElementById('imageArea').classList.add('active');
          checkReady();
        };
        reader.readAsDataURL(file);
      }
    });

    // Video upload
    document.getElementById('videoInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          uploadedVideo = event.target.result;
          document.getElementById('videoPreview').src = uploadedVideo;
          document.getElementById('videoPreview').style.display = 'block';
          document.getElementById('videoArea').classList.add('active');
          checkReady();
        };
        reader.readAsDataURL(file);
      }
    });

    // Marker URL input
    document.getElementById('markerURL').addEventListener('input', function(e) {
      markerURL = e.target.value.trim();
      checkReady();
    });

    function checkReady() {
      const btn = document.getElementById('generateBtn');
      if (uploadedImage && uploadedVideo && markerURL) {
        btn.disabled = false;
      } else {
        btn.disabled = true;
      }
    }

    function generateAR() {
      // Show result
      document.getElementById('resultSection').classList.add('show');
      
      // Update previews
      document.getElementById('finalImage').src = uploadedImage;
      document.getElementById('finalVideo').src = uploadedVideo;
      
      // In real implementation, you'd upload files and get URLs
      // For demo, using placeholder
      const videoURL = 'https://yourserver.com/videos/your-video.mp4';
      
      // Generate AR viewer URL
      const arURL = `https://yoursite.com/ar-viewer-custom-image.html?marker=${encodeURIComponent(markerURL)}&video=${encodeURIComponent(videoURL)}`;
      
      // Update link
      document.getElementById('arLink').href = arURL;
      document.getElementById('arLink').textContent = arURL;
      
      // Generate QR Code
      document.getElementById('qrcode').innerHTML = '';
      new QRCode(document.getElementById('qrcode'), {
        text: arURL,
        width: 256,
        height: 256,
        colorDark: '#000000',
        colorLight: '#ffffff',
        correctLevel: QRCode.CorrectLevel.H
      });
      
      // Scroll to result
      document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
    }

    function downloadQR() {
      const canvas = document.querySelector('#qrcode canvas');
      if (canvas) {
        const link = document.createElement('a');
        link.download = 'ar-experience-qr.png';
        link.href = canvas.toDataURL();
        link.click();
      }
    }

    function copyLink() {
      const link = document.getElementById('arLink').textContent;
      navigator.clipboard.writeText(link).then(() => {
        alert('‚úÖ Link copied to clipboard!');
      });
    }

    function resetForm() {
      uploadedImage = null;
      uploadedVideo = null;
      markerURL = '';
      document.getElementById('imagePreview').style.display = 'none';
      document.getElementById('videoPreview').style.display = 'none';
      document.getElementById('imageArea').classList.remove('active');
      document.getElementById('videoArea').classList.remove('active');
      document.getElementById('markerURL').value = '';
      document.getElementById('generateBtn').disabled = true;
      document.getElementById('resultSection').classList.remove('show');
      document.getElementById('imageInput').value = '';
      document.getElementById('videoInput').value = '';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  </script>
</body>
</html>