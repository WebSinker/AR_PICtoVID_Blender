<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>AR Debug Mode - See What's Happening</title>
  
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.3.0/dist/aframe-master.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    
    #debugPanel {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.9);
      color: #00ff00;
      padding: 15px;
      border-radius: 10px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      z-index: 10000;
      max-width: calc(100% - 20px);
      line-height: 1.6;
    }
    
    .status-good { color: #00ff00; }
    .status-bad { color: #ff0000; }
    .status-warn { color: #ffaa00; }
    
    #startBtn {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #4caf50;
      color: white;
      border: none;
      padding: 30px 60px;
      font-size: 28px;
      border-radius: 40px;
      cursor: pointer;
      z-index: 10001;
      font-weight: bold;
      box-shadow: 0 8px 25px rgba(0,0,0,0.5);
    }

    #markerImage {
      position: fixed;
      bottom: 10px;
      right: 10px;
      width: 150px;
      height: 150px;
      background: white;
      border: 3px solid #4caf50;
      border-radius: 10px;
      z-index: 9999;
      padding: 5px;
    }

    #markerImage img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .blink {
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0%, 50%, 100% { opacity: 1; }
      25%, 75% { opacity: 0.3; }
    }
  </style>
</head>
<body>

  <!-- Start Button -->
  <button id="startBtn" onclick="startAR()">ğŸš€ START DEBUG MODE</button>

  <!-- Debug Panel -->
  <div id="debugPanel">
    <div style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">ğŸ” AR DEBUG MODE</div>
    <div id="log">Initializing...</div>
  </div>

  <!-- Show HIRO Marker Reference -->
  <div id="markerImage" style="display: none;">
    <img src="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png" alt="HIRO Marker">
    <div style="text-align: center; font-size: 10px; margin-top: 5px;">Point camera here â†‘</div>
  </div>

  <!-- AR Scene -->
  <a-scene
    embedded
    arjs="sourceType: webcam; debugUIEnabled: true; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
    vr-mode-ui="enabled: false"
    loading-screen="enabled: false">

    <a-assets>
      <video
        id="vid"
        crossorigin="anonymous"
        loop
        playsinline
        webkit-playsinline
        style="display: none;">
        <!-- Using a reliable video source -->
        <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
      </video>
    </a-assets>

    <a-marker id="marker" preset="hiro" smooth="true" smoothCount="5" smoothTolerance="0.01" smoothThreshold="2">
      
      <!-- Bright border to show detection -->
      <a-box 
        position="0 0 0" 
        rotation="0 0 0" 
        width="2.2" 
        height="0.05" 
        depth="2.2" 
        color="#00ff00"
        opacity="0.8">
      </a-box>
      
      <!-- White background -->
      <a-plane
        position="0 0.01 0"
        rotation="-90 0 0"
        width="2"
        height="2"
        color="#ffffff">
      </a-plane>
      
      <!-- Video -->
      <a-video
        id="videoPlane"
        src="#vid"
        width="1.8"
        height="1.8"
        position="0 0.02 0"
        rotation="-90 0 0">
      </a-video>
      
      <!-- Spinning cube to show tracking is active -->
      <a-box 
        position="0 0.5 0" 
        rotation="0 45 0" 
        color="#ff0000" 
        animation="property: rotation; to: 0 405 0; loop: true; dur: 3000">
      </a-box>
      
    </a-marker>

    <a-entity camera></a-entity>
    
  </a-scene>

  <script>
    const video = document.getElementById('vid');
    const marker = document.getElementById('marker');
    const debugPanel = document.getElementById('log');
    let started = false;
    let markerDetected = false;
    let videoLoaded = false;
    let cameraActive = false;

    // Debug logging function
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      let className = '';
      let icon = 'ğŸ“';
      
      if (type === 'success') {
        className = 'status-good';
        icon = 'âœ…';
      } else if (type === 'error') {
        className = 'status-bad';
        icon = 'âŒ';
      } else if (type === 'warning') {
        className = 'status-warn';
        icon = 'âš ï¸';
      }
      
      const logEntry = `<div class="${className}">[${timestamp}] ${icon} ${message}</div>`;
      debugPanel.innerHTML += logEntry;
      console.log(`[${timestamp}] ${message}`);
      
      // Auto-scroll
      debugPanel.scrollTop = debugPanel.scrollHeight;
    }

    function startAR() {
      document.getElementById('startBtn').style.display = 'none';
      document.getElementById('markerImage').style.display = 'block';
      
      log('ğŸš€ Starting AR Debug Mode...', 'info');
      log('ğŸ“¸ Requesting camera access...', 'info');
      
      // Initialize video
      video.muted = true;
      
      // Test video loading
      video.addEventListener('loadeddata', function() {
        videoLoaded = true;
        log('âœ… Video loaded successfully', 'success');
        log(`ğŸ“¹ Video: ${video.videoWidth}x${video.videoHeight}, Duration: ${Math.round(video.duration)}s`, 'info');
      });
      
      video.addEventListener('error', function(e) {
        log(`âŒ Video loading error: ${e.message || 'Unknown error'}`, 'error');
      });
      
      video.load();
      
      // Try to play once
      video.play().then(() => {
        video.pause();
        video.currentTime = 0;
        log('âœ… Video initialized (play test successful)', 'success');
        started = true;
      }).catch(e => {
        log(`âš ï¸ Video play test failed: ${e.message}`, 'warning');
        log('â„¹ï¸ This is normal - video will play when marker detected', 'info');
        started = true;
      });
      
      // Check camera
      checkCamera();
    }

    function checkCamera() {
      navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
        .then(function(stream) {
          cameraActive = true;
          log('âœ… Camera access granted', 'success');
          log(`ğŸ“± Camera: ${stream.getVideoTracks()[0].label}`, 'info');
          
          const settings = stream.getVideoTracks()[0].getSettings();
          log(`ğŸ“ Resolution: ${settings.width}x${settings.height}`, 'info');
          
          stream.getTracks().forEach(track => track.stop());
          
          log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
          log('ğŸ¯ NOW POINT CAMERA AT HIRO MARKER', 'warning');
          log('   (shown in bottom-right corner)', 'info');
          log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
          
        })
        .catch(function(error) {
          log(`âŒ Camera access DENIED: ${error.message}`, 'error');
          log('âš ï¸ Enable camera in browser settings!', 'error');
        });
    }

    // Marker events
    marker.addEventListener('markerFound', function() {
      markerDetected = true;
      log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'success');
      log('ğŸ‰ MARKER DETECTED!', 'success');
      log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'success');
      log('ğŸ“¹ Starting video playback...', 'info');
      
      // Make marker reference blink
      document.getElementById('markerImage').classList.add('blink');
      
      // Play video
      video.muted = false;
      video.play()
        .then(() => {
          log('âœ… Video playing WITH SOUND', 'success');
          log('ğŸ”Š If no sound, check phone volume!', 'warning');
        })
        .catch(e => {
          log('âš ï¸ Unmuted play failed, trying muted...', 'warning');
          video.muted = true;
          video.play().then(() => {
            log('âœ… Video playing (MUTED)', 'success');
            log('ğŸ”‡ Browser blocked audio autoplay', 'warning');
          });
        });

      // Vibrate
      if (navigator.vibrate) {
        navigator.vibrate(200);
        log('ğŸ“³ Vibration feedback sent', 'info');
      }
    });

    marker.addEventListener('markerLost', function() {
      markerDetected = false;
      log('âŒ Marker lost - searching...', 'warning');
      document.getElementById('markerImage').classList.remove('blink');
      
      if (!video.paused) {
        video.pause();
        log('â¸ï¸ Video paused', 'info');
      }
    });

    // Scene loaded
    const scene = document.querySelector('a-scene');
    scene.addEventListener('loaded', function() {
      log('âœ… AR.js scene loaded', 'success');
      log('âœ… All systems ready', 'success');
    });

    // Periodic status check
    setInterval(function() {
      if (started && !markerDetected) {
        log('ğŸ” Scanning for marker... (move phone around)', 'info');
      }
    }, 5000);

    // Initial help message
    setTimeout(function() {
      log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
      log('ğŸ“‹ SETUP CHECKLIST:', 'info');
      log('1ï¸âƒ£ Tap START DEBUG MODE button', 'info');
      log('2ï¸âƒ£ Allow camera access', 'info');
      log('3ï¸âƒ£ Get HIRO marker (shown bottom-right)', 'info');
      log('4ï¸âƒ£ Point camera at marker', 'info');
      log('5ï¸âƒ£ Keep marker flat & fully visible', 'info');
      log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
    }, 500);
  </script>

</body>
</html>